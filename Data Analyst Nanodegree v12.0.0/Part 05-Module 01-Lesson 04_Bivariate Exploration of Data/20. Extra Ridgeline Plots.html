<!-- udacimak v1.4.4 -->
<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="ie=edge" http-equiv="X-UA-Compatible"/>
  <title>
   Extra: Ridgeline Plots
  </title>
  <link href="../assets/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="../assets/css/plyr.css" rel="stylesheet"/>
  <link href="../assets/css/katex.min.css" rel="stylesheet"/>
  <link href="../assets/css/jquery.mCustomScrollbar.min.css" rel="stylesheet"/>
  <link href="../assets/css/styles.css" rel="stylesheet"/>
  <link href="../assets/img/udacimak.png" rel="shortcut icon" type="image/png">
  </link>
 </head>
 <body>
  <div class="wrapper">
   <nav id="sidebar">
    <div class="sidebar-header">
     <h3>
      Bivariate Exploration of Data
     </h3>
    </div>
    <ul class="sidebar-list list-unstyled CTAs">
     <li>
      <a class="article" href="../index.html">
       Back to Home
      </a>
     </li>
    </ul>
    <ul class="sidebar-list list-unstyled components">
     <li class="">
      <a href="01. Introduction.html">
       01. Introduction
      </a>
     </li>
     <li class="">
      <a href="02. Scatterplots and Correlation.html">
       02. Scatterplots and Correlation
      </a>
     </li>
     <li class="">
      <a href="03. Overplotting, Transparency, and Jitter.html">
       03. Overplotting, Transparency, and Jitter
      </a>
     </li>
     <li class="">
      <a href="04. Heat Maps.html">
       04. Heat Maps
      </a>
     </li>
     <li class="">
      <a href="05. Scatterplot Practice.html">
       05. Scatterplot Practice
      </a>
     </li>
     <li class="">
      <a href="06. Violin Plots.html">
       06. Violin Plots
      </a>
     </li>
     <li class="">
      <a href="07. Box Plots.html">
       07. Box Plots
      </a>
     </li>
     <li class="">
      <a href="08. Violin and Box Plot Practice.html">
       08. Violin and Box Plot Practice
      </a>
     </li>
     <li class="">
      <a href="09. Clustered Bar Charts.html">
       09. Clustered Bar Charts
      </a>
     </li>
     <li class="">
      <a href="10. Categorical Plot Practice.html">
       10. Categorical Plot Practice
      </a>
     </li>
     <li class="">
      <a href="11. Faceting.html">
       11. Faceting
      </a>
     </li>
     <li class="">
      <a href="12. Adaptation of Univariate Plots.html">
       12. Adaptation of Univariate Plots
      </a>
     </li>
     <li class="">
      <a href="13. Line Plots.html">
       13. Line Plots
      </a>
     </li>
     <li class="">
      <a href="14. Additional Plot Practice.html">
       14. Additional Plot Practice
      </a>
     </li>
     <li class="">
      <a href="15. Lesson Summary.html">
       15. Lesson Summary
      </a>
     </li>
     <li class="">
      <a href="16. Extra Q-Q Plots.html">
       16. Extra: Q-Q Plots
      </a>
     </li>
     <li class="">
      <a href="17. Extra Swarm Plots.html">
       17. Extra: Swarm Plots
      </a>
     </li>
     <li class="">
      <a href="18. Extra Rug and Strip Plots.html">
       18. Extra: Rug and Strip Plots
      </a>
     </li>
     <li class="">
      <a href="19. Extra Stacked Plots.html">
       19. Extra: Stacked Plots
      </a>
     </li>
     <li class="">
      <a href="20. Extra Ridgeline Plots.html">
       20. Extra: Ridgeline Plots
      </a>
     </li>
    </ul>
    <ul class="sidebar-list list-unstyled CTAs">
     <li>
      <a class="article" href="../index.html">
       Back to Home
      </a>
     </li>
    </ul>
   </nav>
   <div id="content">
    <header class="container-fluild header">
     <div class="container">
      <div class="row">
       <div class="col-12">
        <div class="align-items-middle">
         <button class="btn btn-toggle-sidebar" id="sidebarCollapse" type="button">
          <div>
          </div>
          <div>
          </div>
          <div>
          </div>
         </button>
         <h1 style="display: inline-block">
          20. Extra: Ridgeline Plots
         </h1>
        </div>
       </div>
      </div>
     </div>
    </header>
    <main class="container">
     <div class="row">
      <div class="col-12">
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <h2 id="ridgeline-plots">
          Ridgeline Plots
         </h2>
         <p>
          One of the hot new visualization types from recent years is the
          <strong>
           ridgeline plot
          </strong>
          . In a nutshell, the ridgeline plot is a series of vertically faceted line plots or density curves, but with somewhat overlapping y-axes. This can be thought of as a contrast to the line plot variation seen in the "Line Plots" part of the lesson, where multiple lines were plotted on the same axes, with different hues. On this page, I'll walk through the creation of a ridgeline plot using some of the demonstration data shown in the "Faceting" page:
         </p>
         <pre><code class="python language-python">group_means = df.groupby(['many_cat_var']).mean()
group_order = group_means.sort_values(['num_var'], ascending = False).index

g = sb.FacetGrid(data = df, col = 'many_cat_var', col_wrap = 5, size = 2,
                 col_order = group_order)
g.map(plt.hist, 'num_var', bins = np.arange(5, 15+1, 1))
g.set_titles('{col_name}')</code></pre>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="Faceted plot, whose data will be converted into a ridgeline form" class="img img-fluid" src="img/l4-c11-faceting3.png"/>
          <figcaption class="figure-caption">
           <p>
            Faceted plot, whose data will be converted into a ridgeline form
           </p>
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          Two things immediately come to mind for changing the faceted histograms into a ridgeline plot. First of all, changing the form of the distribution plots from histograms to kernel density estimates (as seen in the Extras of the previous lesson) will make the overlaps a bit smoother. Second, we need to facet the levels by rows so that they're all stacked up on top of one another.
         </p>
         <pre><code class="python language-python">group_means = df.groupby(['many_cat_var']).mean()
group_order = group_means.sort_values(['num_var'], ascending = False).index

g = sb.FacetGrid(data = df, row = 'many_cat_var', size = 0.75, aspect = 7,
                 row_order = group_order)
g.map(sb.kdeplot, 'num_var', shade = True)
g.set_titles('{row_name}')</code></pre>
         <p>
          <code>
           FacetGrid
          </code>
          and
          <code>
           set_titles
          </code>
          change "col" to "row", also removing "col_wrap". The "size" and "aspect" dimensions have also been adjusted for the large vertical stacking of facets. The
          <code>
           map
          </code>
          function changes to
          <code>
           kdeplot
          </code>
          and removes "bins", adding the "shade" parameter in its place.
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="" class="img img-fluid" src="img/l4-c20-ridgeline1.png"/>
          <figcaption class="figure-caption">
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          Now we've got all of the group distributions stacked on top of one another for a uni-dimensional comparison, but the plot's still pretty tall. Next, we'll create some overlap between the individual subplots.
         </p>
         <pre><code class="python language-python">group_means = df.groupby(['many_cat_var']).mean()
group_order = group_means.sort_values(['num_var'], ascending = False).index

# adjust the spacing of subplots with gridspec_kws
g = sb.FacetGrid(data = df, row = 'many_cat_var', size = 0.5, aspect = 12,
                 row_order = group_order, gridspec_kws = {'hspace' : -0.2})
g.map(sb.kdeplot, 'num_var', shade = True)

# remove the y-axes
g.set(yticks=[])
g.despine(left=True)

g.set_titles('{row_name}')</code></pre>
         <p>
          I've added the "gridspec_kws" parameter to the
          <code>
           FacetGrid
          </code>
          call to adjust the arrangement of subplots in the grid through Matplotlib's
          <a href="https://matplotlib.org/api/_as_gen/matplotlib.gridspec.GridSpec.html" rel="noopener noreferrer" target="_blank">
           <code>
            GridSpec
           </code>
          </a>
          class. By setting "hspec" to a negative value, the subplot axes bounds will overlap vertically. The "size" and "aspect" parameters have also been adjusted. While I'm at it, I'll add some code on the
          <code>
           FacetGrid
          </code>
          object to remove the y-axis through the
          <code>
           despine
          </code>
          method and remove the ticks through the
          <code>
           set
          </code>
          method. They're going to start overlapping, and we don't really need them â€“ we're mostly interested in the relative positions of the distributions rather than specific heights.
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="" class="img img-fluid" src="img/l4-c20-ridgeline2.png"/>
          <figcaption class="figure-caption">
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <p>
          The individual subplots now overlap, but we've still got a problem: the backgrounds of the subplots are opaque, thus obscuring all but the tops of all of the individual group distributions, with the exception of the lowest. In addition, the individual subplot titles overlap the other distributions with some ambiguity: these should be moved elsewhere in the individual plots. The revised code and plot look like this:
         </p>
         <pre><code class="python language-python">group_means = df.groupby(['many_cat_var']).mean()
group_order = group_means.sort_values(['num_var'], ascending = False).index

g = sb.FacetGrid(data = df, row = 'many_cat_var', size = 0.5, aspect = 12,
                 row_order = group_order, gridspec_kws = {'hspace' : -0.2})
g.map(sb.kdeplot, 'num_var', shade = True)

g.set(yticks=[])
g.despine(left=True)

# set the transparency of each subplot to full
g.map(lambda **kwargs: plt.gca().patch.set_alpha(0))

# remove subplot titles and write in new labels
def label_text(x, **kwargs):
    plt.text(4, 0.02, x.iloc[0], ha = 'center', va = 'bottom')
g.map(label_text, 'many_cat_var')
g.set_xlabels('num_var')
g.set_titles('')</code></pre>
         <p>
          We make clever use of the FacetGrid object's
          <code>
           map
          </code>
          function to perform the plot modifications. Previously, you've seen
          <code>
           map
          </code>
          used where the first argument is a plotting function, the following arguments are positional variable strings, and any additional arguments are keyword arguments for the plotting function. In actuality, you can set any function as the first argument, which will be applied to each facet. To apply the transparency using
          <code>
           map
          </code>
          , I set up an anonymous lambda function that gets the current Axes (
          <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.gca.html" rel="noopener noreferrer" target="_blank">
           <code>
            gca
           </code>
          </a>
          ), selects its background (
          <a href="https://matplotlib.org/api/_as_gen/matplotlib.patches.Patch.html" rel="noopener noreferrer" target="_blank">
           <code>
            patch
           </code>
          </a>
          ), and sets its transparency to full.
         </p>
         <p>
          As for the second
          <code>
           map
          </code>
          argument, it sends a pandas Series to the function specified by the first argument. This Series is filtered to include only the column specified by the second
          <code>
           map
          </code>
          argument, with only the rows appropriate for each facet. In this case, I exploit the fact that the 'many_cat_var' column is filled with copies of the categorical feature string to specify the
          <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.text.html" rel="noopener noreferrer" target="_blank">
           <code>
            text
           </code>
          </a>
          string, with hardcoded positional values appropriate to the plot. (
          <code>
           map
          </code>
          also sends a few general keyword arguments like 'color' automatically to the specified function, hence the need for
          <code>
           **kwargs
          </code>
          to capture them despite not specifying any myself.) One downside to this approach is that the x-axis labels get replaced with 'many_cat_var' after the
          <code>
           map
          </code>
          call, thus requiring the addition of a
          <code>
           set_xlabels
          </code>
          function call to reset the string.
         </p>
         <p>
          The final ridgeline plot looks like this, where we can see the distribution of our numeric variable on each category, sorted by mean:
         </p>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <figure class="figure">
          <img alt="" class="img img-fluid" src="img/l4-c20-ridgeline3.png"/>
          <figcaption class="figure-caption">
          </figcaption>
         </figure>
        </div>
       </div>
       <div class="divider">
       </div>
       <div class="ud-atom">
        <h3>
        </h3>
        <div>
         <h2 id="further-reading">
          Further Reading
         </h2>
         <ul>
          <li>
           Seaborn:
           <a href="https://seaborn.pydata.org/examples/kde_ridgeplot.html" rel="noopener noreferrer" target="_blank">
            ridge plot example
           </a>
           - I actually used this example to clean up my initial attempts. It's got a little bit more aesthetic cleaning than the above demonstration.
          </li>
         </ul>
        </div>
       </div>
       <div class="divider">
       </div>
      </div>
      <div class="col-12">
       <p class="text-right">
       </p>
      </div>
     </div>
    </main>
    <footer class="footer">
     <div class="container">
      <div class="row">
       <div class="col-12">
        <p class="text-center">
         udacity2.0 If you need the newest courses Plase add me wechat: udacity6
        </p>
       </div>
      </div>
     </div>
    </footer>
   </div>
  </div>
  <script src="../assets/js/jquery-3.3.1.min.js">
  </script>
  <script src="../assets/js/plyr.polyfilled.min.js">
  </script>
  <script src="../assets/js/bootstrap.min.js">
  </script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js">
  </script>
  <script src="../assets/js/katex.min.js">
  </script>
  <script>
   // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('20. Extra: Ridgeline Plots')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
 </body>
</html>
